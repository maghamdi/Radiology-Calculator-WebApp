<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Radiology Calculator Hub</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Use Inter font */
        body {
            font-family: "Inter", sans-serif;
        }
        /* Custom style for active tab */
        .tab-active {
            border-bottom-color: #3b82f6; /* blue-500 */
            color: #3b82f6;
            font-weight: 600;
        }
        /* Hide content by default */
        .calculator-content {
            display: none;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">

    <div class="container mx-auto p-4 md:p-8 max-w-4xl">

        <!-- Header -->
        <header class="mb-6">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-800">Radiology Calculator Hub</h1>
            <p class="text-gray-600 mt-1">Accurate, up-to-date clinical decision support tools.</p>
        </header>

        <!-- Medical Disclaimer -->
        <div class="mb-6 p-4 bg-yellow-100 border-l-4 border-yellow-500 text-yellow-800 rounded-md shadow-sm" role="alert">
            <p class="font-bold">Disclaimer</p>
            <p>This tool is for informational and educational purposes only. It is not a substitute for professional medical advice, diagnosis, or treatment. All calculations must be confirmed by a qualified healthcare professional.</p>
        </div>

        <!-- Tabs -->
        <div class="mb-6">
            <div class="border-b border-gray-300">
                <nav class="-mb-px flex space-x-4 overflow-x-auto" aria-label="Tabs">
                    <button class="tab-button tab-active whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm" data-tab="egfr">
                        eGFR (CKD-EPI 2021)
                    </button>
                    <button class="tab-button whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-400" data-tab="tirads">
                        ACR TI-RADS (2017)
                    </button>
                    <button class="tab-button whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-400" data-tab="fleischner">
                        Fleischner (2017)
                    </button>
                    <button class="tab-button whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-400" data-tab="pirads">
                        PI-RADS v2.1
                    </button>
                </nav>
            </div>
        </div>

        <!-- Calculator Content Area -->
        <main>
            <!-- eGFR Calculator -->
            <div id="egfr" class="calculator-content bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-2xl font-semibold mb-4 text-blue-600">eGFR (CKD-EPI 2021) Calculator</h2>
                <p class="mb-4 text-gray-700">Calculates estimated Glomerular Filtration Rate using the 2021 CKD-EPI Creatinine equation, which does not use a race variable. This is essential for assessing kidney function before administering IV contrast.</p>
                <form id="egfr-form" class="space-y-4">
                    <div>
                        <label for="creatinine" class="block text-sm font-medium text-gray-700">Serum Creatinine</label>
                        <div class="mt-1 flex rounded-md shadow-sm">
                            <input type="number" id="creatinine" step="any" min="0.1" class="flex-1 block w-full min-w-0 px-3 py-2 border border-gray-300 rounded-l-md focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm" required>
                            <select id="creatinine-unit" class="inline-flex items-center px-3 border border-l-0 border-gray-300 bg-gray-50 text-gray-700 text-sm rounded-r-md">
                                <option value="mg/dL">mg/dL</option>
                                <option value="umol/L">µmol/L</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <label for="age" class="block text-sm font-medium text-gray-700">Age (Years)</label>
                        <input type="number" id="age" step="1" min="18" max="120" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm" required>
                    </div>
                    <div>
                        <label for="sex" class="block text-sm font-medium text-gray-700">Sex</label>
                        <select id="sex" class="mt-1 block w-full px-3 py-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm" required>
                            <option value="">Select...</option>
                            <option value="female">Female</option>
                            <option value="male">Male</option>
                        </select>
                    </div>
                    <button type="submit" class="w-full bg-blue-600 text-white py-2 px-4 rounded-md font-semibold hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                        Calculate eGFR
                    </button>
                </form>
                <div id="egfr-result" class="mt-6"></div>
                <div class="mt-6 pt-4 border-t border-gray-200">
                    <h4 class="font-semibold text-gray-700">References:</h4>
                    <p class="text-sm text-gray-600">1. Inker, L. A., Eneanya, N. D., et al. (2021). New Creatinine- and Cystatin C–Based Equations to Estimate GFR without Race. *New England Journal of Medicine*, 385(19), 1737-1749.</p>
                    <p class="text-sm text-gray-600 mt-1">2. ACR Manual on Contrast Media (2024). American College of Radiology. Version 2024.</p>
                </div>
            </div>

            <!-- TI-RADS Calculator -->
            <div id="tirads" class="calculator-content bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-2xl font-semibold mb-4 text-green-600">ACR TI-RADS (2017) Calculator</h2>
                <p class="mb-4 text-gray-700">Calculates the TI-RADS score for a thyroid nodule based on 5 ultrasound categories to assess malignancy risk and guide management.</p>
                <form id="tirads-form" class="space-y-6">
                    <!-- Composition -->
                    <fieldset>
                        <legend class="text-base font-medium text-gray-900">1. Composition</legend>
                        <div class="mt-2 space-y-2">
                            <label class="flex items-center"><input type="radio" name="composition" value="0" class="focus:ring-green-500 h-4 w-4 text-green-600 border-gray-300" required> <span class="ml-2 text-sm text-gray-700">Cystic or almost completely cystic (0 pts)</span></label>
                            <label class="flex items-center"><input type="radio" name="composition" value="0" class="focus:ring-green-500 h-4 w-4 text-green-600 border-gray-300"> <span class="ml-2 text-sm text-gray-700">Spongiform (0 pts)</span></label>
                            <label class="flex items-center"><input type="radio" name="composition" value="1" class="focus:ring-green-500 h-4 w-4 text-green-600 border-gray-300"> <span class="ml-2 text-sm text-gray-700">Mixed cystic and solid (1 pt)</span></label>
                            <label class="flex items-center"><input type="radio" name="composition" value="2" class="focus:ring-green-500 h-4 w-4 text-green-600 border-gray-300"> <span class="ml-2 text-sm text-gray-700">Solid or almost completely solid (2 pts)</span></label>
                        </div>
                    </fieldset>

                    <!-- Echogenicity -->
                    <fieldset>
                        <legend class="text-base font-medium text-gray-900">2. Echogenicity</legend>
                        <div class="mt-2 space-y-2">
                            <label class="flex items-center"><input type="radio" name="echogenicity" value="0" class="focus:ring-green-500 h-4 w-4 text-green-600 border-gray-300" required> <span class="ml-2 text-sm text-gray-700">Anechoic (0 pts)</span></label>
                            <label class="flex items-center"><input type="radio" name="echogenicity" value="1" class="focus:ring-green-500 h-4 w-4 text-green-600 border-gray-300"> <span class="ml-2 text-sm text-gray-700">Hyperechoic or Isoechoic (1 pt)</span></label>
                            <label class="flex items-center"><input type="radio" name="echogenicity" value="2" class="focus:ring-green-500 h-4 w-4 text-green-600 border-gray-300"> <span class="ml-2 text-sm text-gray-700">Hypoechoic (2 pts)</span></label>
                            <label class="flex items-center"><input type="radio" name="echogenicity" value="3" class="focus:ring-green-500 h-4 w-4 text-green-600 border-gray-300"> <span class="ml-2 text-sm text-gray-700">Very Hypoechoic (3 pts)</span></label>
                        </div>
                    </fieldset>

                    <!-- Shape -->
                    <fieldset>
                        <legend class="text-base font-medium text-gray-900">3. Shape (Transverse)</legend>
                        <div class="mt-2 space-y-2">
                            <label class="flex items-center"><input type="radio" name="shape" value="0" class="focus:ring-green-500 h-4 w-4 text-green-600 border-gray-300" required> <span class="ml-2 text-sm text-gray-700">Wider-than-tall (0 pts)</span></label>
                            <label class="flex items-center"><input type="radio" name="shape" value="3" class="focus:ring-green-500 h-4 w-4 text-green-600 border-gray-300"> <span class="ml-2 text-sm text-gray-700">Taller-than-wide (3 pts)</span></label>
                        </div>
                    </fieldset>

                    <!-- Margin -->
                    <fieldset>
                        <legend class="text-base font-medium text-gray-900">4. Margin</legend>
                        <div class="mt-2 space-y-2">
                            <label class="flex items-center"><input type="radio" name="margin" value="0" class="focus:ring-green-500 h-4 w-4 text-green-600 border-gray-300" required> <span class="ml-2 text-sm text-gray-700">Smooth (0 pts)</span></label>
                            <label class="flex items-center"><input type="radio" name="margin" value="0" class="focus:ring-green-500 h-4 w-4 text-green-600 border-gray-300"> <span class="ml-2 text-sm text-gray-700">Ill-defined (0 pts)</span></label>
                            <label class="flex items-center"><input type="radio" name="margin" value="2" class="focus:ring-green-500 h-4 w-4 text-green-600 border-gray-300"> <span class="ml-2 text-sm text-gray-700">Lobulated or Irregular (2 pts)</span></label>
                            <label class="flex items-center"><input type="radio" name="margin" value="3" class="focus:ring-green-500 h-4 w-4 text-green-600 border-gray-300"> <span class="ml-2 text-sm text-gray-700">Extrathyroidal extension (3 pts)</span></label>
                        </div>
                    </fieldset>

                    <!-- Echogenic Foci -->
                    <fieldset>
                        <legend class="text-base font-medium text-gray-900">5. Echogenic Foci</legend>
                        <p class="text-sm text-gray-500">Select all that apply. The highest point value will be used.</p>
                        <div class="mt-2 space-y-2">
                            <label class="flex items-center"><input type="checkbox" name="foci" value="0" class="focus:ring-green-500 h-4 w-4 text-green-600 border-gray-300 rounded"> <span class="ml-2 text-sm text-gray-700">None or Large comet-tail artifacts (0 pts)</span></label>
                            <label class="flex items-center"><input type="checkbox" name="foci" value="1" class="focus:ring-green-500 h-4 w-4 text-green-600 border-gray-300 rounded"> <span class="ml-2 text-sm text-gray-700">Macrocalcifications (1 pt)</span></label>
                            <label class="flex items-center"><input type="checkbox" name="foci" value="2" class="focus:ring-green-500 h-4 w-4 text-green-600 border-gray-300 rounded"> <span class="ml-2 text-sm text-gray-700">Peripheral (rim) calcifications (2 pts)</span></label>
                            <label class="flex items-center"><input type="checkbox" name="foci" value="3" class="focus:ring-green-500 h-4 w-4 text-green-600 border-gray-300 rounded"> <span class="ml-2 text-sm text-gray-700">Punctate echogenic foci (3 pts)</span></label>
                        </div>
                    </fieldset>

                    <button type="submit" class="w-full bg-green-600 text-white py-2 px-4 rounded-md font-semibold hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">
                        Calculate TI-RADS Score
                    </button>
                </form>
                <div id="tirads-result" class="mt-6"></div>
                <div class="mt-6 pt-4 border-t border-gray-200">
                    <h4 class="font-semibold text-gray-700">Reference:</h4>
                    <p class="text-sm text-gray-600">Tessler, F. N., et al. (2017). ACR Thyroid Imaging, Reporting and Data System (TI-RADS): White Paper of the ACR TI-RADS Committee. *Journal of the American College of Radiology*, 14(5), 587-595.</p>
                </div>
            </div>

            <!-- Fleischner Calculator -->
            <div id="fleischner" class="calculator-content bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-2xl font-semibold mb-4 text-purple-600">Fleischner (2017) Solid Nodule</h2>
                <p class="mb-4 text-gray-700">Provides follow-up recommendations for incidental, solid pulmonary nodules in patients aged 35+ based on the 2017 Fleischner Society guidelines.</p>
                <form id="fleischner-form" class="space-y-4">
                    <div>
                        <label for="nodule-size" class="block text-sm font-medium text-gray-700">Nodule Size (Average Diameter, mm)</label>
                        <input type="number" id="nodule-size" step="0.1" min="0.1" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-purple-500 focus:border-purple-500 sm:text-sm" required>
                    </div>
                    <div>
                        <label for="patient-risk" class="block text-sm font-medium text-gray-700">Patient Risk</label>
                        <select id="patient-risk" class="mt-1 block w-full px-3 py-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-purple-500 focus:border-purple-500 sm:text-sm" required>
                            <option value="">Select...</option>
                            <option value="low">Low Risk</option>
                            <option value="high">High Risk (e.g., heavy smoking history, other risk factors)</option>
                        </select>
                    </div>
                    <button type="submit" class="w-full bg-purple-600 text-white py-2 px-4 rounded-md font-semibold hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500">
                        Get Recommendation
                    </button>
                </form>
                <div id="fleischner-result" class="mt-6"></div>
                <div class="mt-6 pt-4 border-t border-gray-200">
                    <h4 class="font-semibold text-gray-700">Reference:</h4>
                    <p class="text-sm text-gray-600">MacMahon, H., et al. (2017). Guidelines for Management of Incidental Pulmonary Nodules Detected on CT Scans: From the Fleischner Society 2017. *Radiology*, 284(1), 228-243.</p>
                </div>
            </div>

            <!-- PI-RADS v2.1 Calculator -->
            <div id="pirads" class="calculator-content bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-2xl font-semibold mb-4 text-cyan-600">PI-RADS v2.1 Calculator</h2>
                <p class="mb-4 text-gray-700">Calculates the PI-RADS score for a prostate lesion based on location (PZ vs. TZ) and dominant sequence findings, as per the 2019 PI-RADS v2.1 guidelines.</p>
                <form id="pirads-form" class="space-y-4">
                    <div>
                        <label for="lesion-location" class="block text-sm font-medium text-gray-700">1. Lesion Location</label>
                        <select id="lesion-location" class="mt-1 block w-full px-3 py-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-cyan-500 focus:border-cyan-500 sm:text-sm" required>
                            <option value="">Select location...</option>
                            <option value="pz">Peripheral Zone (PZ)</option>
                            <option value="tz">Transition Zone (TZ)</option>
                        </select>
                    </div>

                    <!-- PZ Questions (Hidden by default) -->
                    <div id="pz-questions" class="hidden space-y-4">
                        <div>
                            <label for="pz-dwi" class="block text-sm font-medium text-gray-700">2. DWI Score</label>
                            <select id="pz-dwi" class="mt-1 block w-full px-3 py-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-cyan-500 focus:border-cyan-500 sm:text-sm">
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                            </select>
                        </div>
                        <div id="pz-dce-question" class="hidden">
                            <label for="pz-dce" class="block text-sm font-medium text-gray-700">3. DCE Status</label>
                            <select id="pz-dce" class="mt-1 block w-full px-3 py-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-cyan-500 focus:border-cyan-500 sm:text-sm">
                                <option value="neg">Negative (No focal or early enhancement)</option>
                                <option value="pos">Positive (Focal and early enhancement)</option>
                            </select>
                        </div>
                    </div>

                    <!-- TZ Questions (Hidden by default) -->
                    <div id="tz-questions" class="hidden space-y-4">
                        <div>
                            <label for="tz-t2" class="block text-sm font-medium text-gray-700">2. T2W Score</label>
                            <select id="tz-t2" class="mt-1 block w-full px-3 py-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-cyan-500 focus:border-cyan-500 sm:text-sm">
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                            </select>
                        </div>
                        <div id="tz-dwi-question" class="hidden">
                            <label for="tz-dwi" class="block text-sm font-medium text-gray-700">3. DWI Score</label>
                            <select id="tz-dwi" class="mt-1 block w-full px-3 py-2 border border-gray-300 bg-white rounded-md shadow-sm focus:outline-none focus:ring-cyan-500 focus:border-cyan-500 sm:text-sm">
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4 (DWI < 5)</option>
                                <option value="5">5 (DWI = 5)</option>
                            </select>
                        </div>
                    </div>

                    <button type="submit" class="w-full bg-cyan-600 text-white py-2 px-4 rounded-md font-semibold hover:bg-cyan-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-cyan-500">
                        Calculate PI-RADS Score
                    </button>
                </form>
                <div id="pirads-result" class="mt-6"></div>
                <div class="mt-6 pt-4 border-t border-gray-200">
                    <h4 class="font-semibold text-gray-700">Reference:</h4>
                    <p class="text-sm text-gray-600">Turkbey, B., et al. (2019). PI-RADS 2.1: 2019 Update of Prostate Imaging Reporting and Data System. *Radiology*, 291(2), 465-475.</p>
                </div>
            </div>

        </main>
    </div>

    <script>
        // --- Tab Navigation ---
        const tabs = document.querySelectorAll('.tab-button');
        const contents = document.querySelectorAll('.calculator-content');

        // Show the first tab content by default
        contents[0].style.display = 'block';

        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                // Remove active class from all tabs
                tabs.forEach(t => t.classList.remove('tab-active', 'text-gray-500'));
                // Add inactive class to all tabs
                tabs.forEach(t => t.classList.add('text-gray-500'));

                // Add active class to clicked tab
                tab.classList.add('tab-active');
                tab.classList.remove('text-gray-500');

                // Hide all content
                contents.forEach(content => content.style.display = 'none');

                // Show content for clicked tab
                const tabId = tab.getAttribute('data-tab');
                document.getElementById(tabId).style.display = 'block';
            });
        });

        // --- eGFR Calculator Logic ---
        document.getElementById('egfr-form').addEventListener('submit', function(e) {
            e.preventDefault();
            let cr = parseFloat(document.getElementById('creatinine').value);
            const crUnit = document.getElementById('creatinine-unit').value;
            const age = parseInt(document.getElementById('age').value);
            const sex = document.getElementById('sex').value;
            const resultDiv = document.getElementById('egfr-result');

            // Convert cr to mg/dL if it's in µmol/L
            // 1 mg/dL = 88.4 µmol/L
            if (crUnit === 'umol/L') {
                cr = cr / 88.4;
            }

            let k, a;
            if (sex === 'female') {
                k = 0.7;
                a = (cr <= 0.7) ? -0.241 : -1.200;
            } else { // male
                k = 0.9;
                a = (cr <= 0.9) ? -0.302 : -1.200;
            }

            let eGFR = 142 * Math.pow(Math.min(cr / k, 1.0), a) * Math.pow(Math.max(cr / k, 1.0), -1.200) * Math.pow(0.9938, age);

            if (sex === 'female') {
                eGFR *= 1.012;
            }

            eGFR = eGFR.toFixed(0);

            let resultClass = 'border-green-400 bg-green-100 text-green-800';
            let ctMessage = "<strong>CT (Iodinated):</strong> No precautions needed for CIN.";
            let mriMessage = "<strong>MRI (Gadolinium):</strong> No restrictions for any GBCAs.";

            if (eGFR < 60 && eGFR >= 45) {
                resultClass = 'border-green-400 bg-green-100 text-green-800';
                ctMessage = "<strong>CT (Iodinated):</strong> No precautions needed for CIN.";
                mriMessage = "<strong>MRI (Gadolinium):</strong> No restrictions for any GBCAs.";
            } else if (eGFR < 45 && eGFR >= 30) {
                resultClass = 'border-yellow-400 bg-yellow-100 text-yellow-800';
                ctMessage = "<strong>CT (Iodinated):</strong> Low risk of CIN. Ensure patient is hydrated.";
                mriMessage = "<strong>MRI (Gadolinium):</strong> No contraindication for ACR Group II/III GBCAs. Group I GBCAs are contraindicated.";
            } else if (eGFR < 30) {
                resultClass = 'border-red-500 bg-red-100 text-red-800';
                ctMessage = "<strong>CT (Iodinated):</strong> High risk of CIN. Hydrate patient, use lowest necessary dose, and consider alternatives. Avoid in acute kidney injury unless urgent.";
                mriMessage = "<strong>MRI (Gadolinium):</strong> No contraindication for ACR Group II/III GBCAs (per ACR 2024, no evidence of NSF risk). Group I GBCAs are contraindicated.";
            }

            resultDiv.innerHTML = `
                <div class="p-4 rounded-md border ${resultClass}">
                    <p class="font-bold text-lg">Result: ${eGFR} mL/min/1.73m²</p>
                    <div class="mt-4 space-y-2">
                        <p class="font-semibold">Contrast Guidelines (ACR 2024):</p>
                        <p class="text-sm">${ctMessage}</p>
                        <p class="text-sm">${mriMessage}</p>
                    </div>
                </div>
            `;
        });

        // --- TI-RADS Calculator Logic ---
        document.getElementById('tirads-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const resultDiv = document.getElementById('tirads-result');

            let totalPoints = 0;

            // 1. Composition
            totalPoints += parseInt(document.querySelector('input[name="composition"]:checked').value);

            // 2. Echogenicity
            totalPoints += parseInt(document.querySelector('input[name="echogenicity"]:checked').value);

            // 3. Shape
            totalPoints += parseInt(document.querySelector('input[name="shape"]:checked').value);

            // 4. Margin
            totalPoints += parseInt(document.querySelector('input[name="margin"]:checked').value);

            // 5. Echogenic Foci
            const fociChecks = document.querySelectorAll('input[name="foci"]:checked');
            let maxFociPoints = 0;
            if (fociChecks.length === 0) {
                // If none are selected, force user to select one (or assume "None")
                // For simplicity, we'll check if "None" was checked. If not, and nothing else was, it's an incomplete form.
                // A better form would have "None" as a radio button or default.
                // For this demo, we'll just use the max value.
                const noneBox = document.querySelector('input[name="foci"][value="0"]');
                if (!noneBox.checked) {
                     // Check if at least one box is checked, if not, add 0 points.
                     // This logic assumes "None" is checked if nothing else is.
                     let oneChecked = false;
                     document.querySelectorAll('input[name="foci"]').forEach(c => {
                         if (c.checked) oneChecked = true;
                     });
                     if (!oneChecked) {
                         // A real app should validate this better
                         resultDiv.innerHTML = `<div class="p-4 rounded-md border border-red-400 bg-red-100 text-red-800"><p>Please select at least one option for Echogenic Foci (e.g., "None").</p></div>`;
                         return;
                     }
                }
            }

            fociChecks.forEach(check => {
                maxFociPoints = Math.max(maxFociPoints, parseInt(check.value));
            });
            totalPoints += maxFociPoints;

            let level = "";
            let recommendation = "";
            let riskClass = "border-gray-400 bg-gray-100 text-gray-800";

            if (totalPoints === 0) {
                level = "TR1 (Benign)";
                recommendation = "No FNA or Follow-up.";
                riskClass = "border-green-400 bg-green-100 text-green-800";
            } else if (totalPoints <= 2) {
                level = "TR2 (Not Suspicious)";
                recommendation = "No FNA or Follow-up.";
                riskClass = "border-green-400 bg-green-100 text-green-800";
            } else if (totalPoints === 3) {
                level = "TR3 (Mildly Suspicious)";
                recommendation = "FNA if ≥ 2.5 cm. Follow-up if ≥ 1.5 cm.";
                riskClass = "border-yellow-400 bg-yellow-100 text-yellow-800";
            } else if (totalPoints >= 4 && totalPoints <= 6) {
                level = "TR4 (Moderately Suspicious)";
                recommendation = "FNA if ≥ 1.5 cm. Follow-up if ≥ 1.0 cm.";
                riskClass = "border-orange-400 bg-orange-100 text-orange-800";
            } else { // 7 or more
                level = "TR5 (Highly Suspicious)";
                recommendation = "FNA if ≥ 1.0 cm. Follow-up if ≥ 0.5 cm.";
                riskClass = "border-red-400 bg-red-100 text-red-800";
            }

            resultDiv.innerHTML = `
                <div class="p-4 rounded-md border ${riskClass}">
                    <p class="font-bold text-lg">Total Points: ${totalPoints}</p>
                    <p class="font-semibold text-md mt-1">Level: ${level}</p>
                    <p class="mt-2"><strong>Recommendation:</strong> ${recommendation}</p>
                </div>
            `;
        });

        // --- Fleischner Calculator Logic ---
        document.getElementById('fleischner-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const size = parseFloat(document.getElementById('nodule-size').value);
            const risk = document.getElementById('patient-risk').value;
            const resultDiv = document.getElementById('fleischner-result');

            let recommendation = "";
            let riskClass = "border-green-400 bg-green-100 text-green-800";

            if (size < 6) {
                if (risk === 'low') {
                    recommendation = "No routine follow-up required.";
                } else { // high risk
                    recommendation = "Optional CT at 12 months.";
                    riskClass = "border-yellow-400 bg-yellow-100 text-yellow-800";
                }
            } else if (size >= 6 && size <= 8) {
                if (risk === 'low') {
                    recommendation = "Follow-up CT at 6-12 months.";
                } else { // high risk
                    recommendation = "Follow-up CT at 6-12 months, then consider 18-24 months.";
                }
                riskClass = "border-yellow-400 bg-yellow-100 text-yellow-800";
            } else { // size > 8
                recommendation = "Consider CT at 3 months, PET/CT, or tissue sampling.";
                riskClass = "border-red-400 bg-red-100 text-red-800";
            }

            resultDiv.innerHTML = `
                <div class="p-4 rounded-md border ${riskClass}">
                    <p class="font-bold text-lg">Recommendation:</p>
                    <p class="mt-1">${recommendation}</p>
                </div>
            `;
        });

        // --- PI-RADS v2.1 Calculator Logic ---
        const lesionLocation = document.getElementById('lesion-location');
        const pzQuestions = document.getElementById('pz-questions');
        const tzQuestions = document.getElementById('tz-questions');
        const pzDwi = document.getElementById('pz-dwi');
        const pzDceQuestion = document.getElementById('pz-dce-question');
        const tzT2 = document.getElementById('tz-t2');
        const tzDwiQuestion = document.getElementById('tz-dwi-question');

        // Show/hide questions based on lesion location
        lesionLocation.addEventListener('change', function() {
            if (this.value === 'pz') {
                pzQuestions.classList.remove('hidden');
                tzQuestions.classList.add('hidden');
            } else if (this.value === 'tz') {
                tzQuestions.classList.remove('hidden');
                pzQuestions.classList.add('hidden');
            } else {
                pzQuestions.classList.add('hidden');
                tzQuestions.classList.add('hidden');
            }
            // Reset conditional fields
            pzDceQuestion.classList.add('hidden');
            tzDwiQuestion.classList.add('hidden');
        });

        // Show/hide PZ DCE question based on DWI score
        pzDwi.addEventListener('change', function() {
            if (this.value === '3') {
                pzDceQuestion.classList.remove('hidden');
            } else {
                pzDceQuestion.classList.add('hidden');
            }
        });

        // Show/hide TZ DWI question based on T2 score
        tzT2.addEventListener('change', function() {
            if (this.value === '3') {
                tzDwiQuestion.classList.remove('hidden');
            } else {
                tzDwiQuestion.classList.add('hidden');
            }
        });

        // Handle PI-RADS form submission
        document.getElementById('pirads-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const location = document.getElementById('lesion-location').value;
            const resultDiv = document.getElementById('pirads-result');
            let piradsScore = 0;
            let explanation = "";

            if (location === 'pz') {
                const dwi = parseInt(document.getElementById('pz-dwi').value);
                if (dwi === 3) {
                    const dce = document.getElementById('pz-dce').value;
                    if (dce === 'pos') {
                        piradsScore = 4;
                        explanation = "PZ Lesion with DWI 3 and Positive DCE = PI-RADS 4";
                    } else { // neg
                        piradsScore = 3;
                        explanation = "PZ Lesion with DWI 3 and Negative DCE = PI-RADS 3";
                    }
                } else if (dwi === 1) {
                    piradsScore = 1;
                    explanation = "PZ Lesion with DWI 1 = PI-RADS 1";
                } else if (dwi === 2) {
                    piradsScore = 2;
                    explanation = "PZ Lesion with DWI 2 = PI-RADS 2";
                } else if (dwi === 4) {
                    piradsScore = 4;
                    explanation = "PZ Lesion with DWI 4 = PI-RADS 4";
                } else { // dwi === 5
                    piradsScore = 5;
                    explanation = "PZ Lesion with DWI 5 = PI-RADS 5";
                }
            } else if (location === 'tz') {
                const t2 = parseInt(document.getElementById('tz-t2').value);
                if (t2 === 3) {
                    const dwi = parseInt(document.getElementById('tz-dwi').value);
                    if (dwi === 5) {
                        piradsScore = 4;
                        explanation = "TZ Lesion with T2W 3 and DWI 5 = PI-RADS 4";
                    } else { // dwi < 5
                        piradsScore = 3;
                        explanation = "TZ Lesion with T2W 3 and DWI < 5 = PI-RADS 3";
                    }
                } else if (t2 === 1) {
                    piradsScore = 1;
                    explanation = "TZ Lesion with T2W 1 = PI-RADS 1";
                } else if (t2 === 2) {
                    piradsScore = 2;
                    explanation = "TZ Lesion with T2W 2 = PI-RADS 2";
                } else if (t2 === 4) {
                    piradsScore = 4;
                    explanation = "TZ Lesion with T2W 4 = PI-RADS 4";
                } else { // t2 === 5
                    piradsScore = 5;
                    explanation = "TZ Lesion with T2W 5 = PI-RADS 5";
                }
            }

            let riskClass = "border-green-400 bg-green-100 text-green-800";
            if (piradsScore === 3) {
                riskClass = "border-yellow-400 bg-yellow-100 text-yellow-800";
            } else if (piradsScore === 4) {
                riskClass = "border-orange-400 bg-orange-100 text-orange-800";
            } else if (piradsScore === 5) {
                riskClass = "border-red-400 bg-red-100 text-red-800";
            }

            resultDiv.innerHTML = `
                <div class="p-4 rounded-md border ${riskClass}">
                    <p class="font-bold text-lg">Final Score: PI-RADS ${piradsScore}</p>
                    <p class="mt-1"><strong>Logic:</strong> ${explanation}</p>
                </div>
            `;
        });
    </script>
</body>
</html>